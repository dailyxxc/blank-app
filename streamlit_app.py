import streamlit as st
import pandas as pd
import numpy as np
import warnings
warnings.filterwarnings('ignore')
import seaborn as sns
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
from sklearn.preprocessing import LabelEncoder
from sklearn.model_selection import train_test_split
from sklearn.tree import DecisionTreeClassifier
from sklearn.ensemble import RandomForestClassifier
from sklearn.ensemble import AdaBoostClassifier
from sklearn.ensemble import GradientBoostingClassifier
from sklearn.model_selection import cross_val_score
import time
import logging  
from pathlib import Path
import joblib
import os
from pathlib import Path
import streamlit as st
import base64

# è®¾ç½®é¡µé¢æ ‡é¢˜  
st.markdown("<h1 style='text-align: center;'>PART1 åŸºäºé¥®é£Ÿä¹ æƒ¯çš„ä¸ªæ€§åŒ–è‚¥èƒ–ç¨‹åº¦åˆ†æğŸ¥—</h1>", unsafe_allow_html=True) 

# ä¾§è¾¹æ æˆåŠŸæç¤º
st.sidebar.success("è¯·å®Œæˆæ•°æ®ä¸Šä¼ åå†ä½¿ç”¨ä¾§è¾¹æ åŠŸèƒ½å–”â¤")


# è·å–è„šæœ¬æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„
path = str(Path(__file__).parent.absolute())

# æ„å»ºè§†é¢‘æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
video_file_path = Path(path) / "fit.mp4"

# æ‰“å¼€è§†é¢‘æ–‡ä»¶
video_file = open(video_file_path, 'rb')
video_bytes = video_file.read()

st.markdown(
    """
    ### ä¸€ã€æ„ä¹‰
    éšç€ç”Ÿæ´»æ–¹å¼çš„æ”¹å˜ï¼Œè‚¥èƒ–é—®é¢˜æ—¥ç›Šä¸¥é‡ã€‚äº†è§£å’ŒæŒæ¡å½±å“è‚¥èƒ–çš„å› ç´ ï¼Œå¹¶å¯¹è‚¥èƒ–ç¨‹åº¦è¿›è¡Œåˆ†ç±»å’Œé¢„æµ‹ï¼Œå¯¹äºè‚¥èƒ–çš„é¢„é˜²å’Œæ§åˆ¶ç­–ç•¥çš„åˆ¶å®šå…·æœ‰é‡è¦æ„ä¹‰ã€‚æœ¬é¡¹ç›®æ—¨åœ¨é€šè¿‡æ•°æ®åˆ†æï¼Œä¸ºä¸ªæ€§åŒ–è‚¥èƒ–é¢„é˜²å’Œå¹²é¢„æä¾›ä¾æ®ï¼Œå¸®åŠ©äººä»¬æ›´å¥½åœ°ç®¡ç†å¥åº·ã€‚
"""
)


st.write("# ä»‹ç»ğŸ— ")
#æœ¬åœ°è§†é¢‘
st.video(video_bytes,format="mp4",start_time=2)
# æ·»åŠ å‡ºå¤„é“¾æ¥  
st.markdown("[å‡ºå¤„é“¾æ¥](https://www.bilibili.com/video/BV1s54y1r7Ed/?spm_id_from=333.337.search-card.all.click&vd_source=096a17588c803a5145918c456427c022)")  

# é¡µé¢ä¸»ä½“å†…å®¹
st.markdown(
    """
    ### äºŒã€ç‰¹å¾
    æˆ‘ä»¬çš„æ•°æ®é›†ä¸­åŒ…å«äº†å¤šä¸ªä¸é¥®é£Ÿä¹ æƒ¯å’Œèº«ä½“çŠ¶å†µç›¸å…³çš„ç‰¹å¾ï¼Œå¦‚æ€§åˆ«ã€å¹´é¾„ã€èº«é«˜ã€ä½“é‡ã€å®¶æ—è‚¥èƒ–å²ã€ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ã€æ—¥å¸¸è”¬èœæ‘„å…¥ã€æ¯æ—¥ä¸»é¤æ¬¡æ•°ã€é¤é—´è¿›é£Ÿã€å¸çƒŸæƒ…å†µã€é¥®æ°´é‡ã€æ¯æ—¥å¡è·¯é‡Œç›‘æµ‹æƒ…å†µã€èº«ä½“æ´»åŠ¨é¢‘ç‡ã€ä½¿ç”¨ç”µå­è®¾å¤‡æ—¶é—´ã€é¥®é…’é¢‘ç‡ã€æ—¥å¸¸äº¤é€šæ–¹å¼ç­‰ã€‚è¿™äº›ç‰¹å¾ä¸è‚¥èƒ–ç¨‹åº¦æœ‰ç€ä¸åŒç¨‹åº¦çš„ç›¸å…³æ€§ï¼Œä¾‹å¦‚å®¶æ—è‚¥èƒ–å²ã€å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ç­‰ä¸è‚¥èƒ–ç¨‹åº¦å‘ˆæ˜æ˜¾æ­£ç›¸å…³ï¼Œè€Œæ€§åˆ«ã€å¸çƒŸæƒ…å†µç­‰ç›¸å…³æ€§è¾ƒå¼±ã€‚
"""
)
import streamlit as st  
import pandas as pd  

# åˆ›å»ºæ•°æ®  
data = {  
    "å˜é‡åç§°": [  
        "Genderï¼ˆæ€§åˆ«ï¼‰",  
        "Ageï¼ˆå¹´é¾„ï¼‰",  
        "Heightï¼ˆèº«é«˜ï¼‰",  
        "Weightï¼ˆä½“é‡ï¼‰",  
        "family_history_with_overweightï¼ˆå®¶æ—è‚¥èƒ–å²ï¼‰",  
        "FAVCï¼ˆç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ï¼‰",  
        "FCVCï¼ˆæ—¥å¸¸è”¬èœæ‘„å…¥ï¼‰",  
        "NCPï¼ˆæ¯æ—¥ä¸»é¤æ¬¡æ•°ï¼‰",  
        "CAECï¼ˆé¤é—´è¿›é£Ÿï¼‰",  
        "SMOKEï¼ˆå¸çƒŸæƒ…å†µï¼‰",  
        "Waterï¼ˆé¥®æ°´é‡ï¼‰",  
        "CALCï¼ˆå®¶æ—è‚¥èƒ–å²ï¼‰",  
        "FAVCï¼ˆç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ï¼‰",  
        "NObeyesdadï¼ˆæ—¥å¸¸è”¬èœæ‘„å…¥ï¼‰"  
    ],  
    "ä½œç”¨": [  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾",  
        "ç‰¹å¾"  
    ],  
    "ç±»å‹": [  
        "åˆ†ç±»å˜é‡",  
        "è¿ç»­å˜é‡",  
        "è¿ç»­å˜é‡",  
        "è¿ç»­å˜é‡",  
        "äºŒåˆ†ç±»å˜é‡",  
        "äºŒåˆ†ç±»å˜é‡",  
        "æ•´æ•°å˜é‡",  
        "è¿ç»­å˜é‡",  
        "åˆ†ç±»å˜é‡",  
        "äºŒåˆ†ç±»å˜é‡",  
        "åˆ†ç±»å˜é‡",  
        "äºŒåˆ†ç±»å˜é‡",  
        "äºŒåˆ†ç±»å˜é‡",  
        "æ•´æ•°å˜é‡"  
    ],  
    "äººå£ç»Ÿè®¡å­¦ä¿¡æ¯": [  
        "æ€§åˆ«",  
        "å¹´é¾„",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— "  
    ],  
    "æè¿°": [  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "å®¶æ—æˆå‘˜æ˜¯å¦æ›¾æ‚£æˆ–æ­£æ‚£æœ‰è¶…é‡ï¼Ÿ",  
        "ä½ æ˜¯å¦ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ï¼Ÿ",  
        "ä½ åœ¨é¤é£Ÿä¸­é€šå¸¸æ˜¯å¦åƒè”¬èœï¼Ÿ",  
        "ä½ æ¯å¤©æœ‰å‡ é¡¿ä¸»é¤ï¼Ÿ",  
        "ä½ åœ¨ä¸¤é¤ä¹‹é—´æ˜¯å¦åƒä»»ä½•é£Ÿç‰©ï¼Ÿ",  
        "ä½ å¸çƒŸå—ï¼Ÿ",  
        "ä½ æ¯å¤©å–å¤šå°‘æ°´ï¼Ÿ",  
        "å®¶æ—æˆå‘˜æ˜¯å¦æ›¾æ‚£æˆ–æ­£æ‚£æœ‰è¶…é‡ï¼Ÿ",  
        "ä½ æ˜¯å¦ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ï¼Ÿ",  
        "ä½ åœ¨é¤é£Ÿä¸­é€šå¸¸æ˜¯å¦åƒè”¬èœï¼Ÿ"  
    ],  
    "å•ä½": [  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— "  
    ],  
    "ç¼ºå¤±å€¼æƒ…å†µ": [  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— ",  
        "æ— "  
    ]  
}  

# å°†æ•°æ®è½¬æ¢ä¸º DataFrame  
df = pd.DataFrame(data)  


# æ˜¾ç¤ºæ•°æ®è¡¨  
st.dataframe(df)

st.markdown(
    """
    ### ä¸‰ã€ä»»åŠ¡
      æœ¬é¡¹ç›®çš„ä¸»è¦ä»»åŠ¡æ˜¯åˆ©ç”¨æœºå™¨å­¦ä¹ æ–¹æ³•ï¼ŒåŸºäºä¸ªäººçš„é¥®é£Ÿä¹ æƒ¯å’Œèº«ä½“çŠ¶å†µæ•°æ®ï¼Œå‡†ç¡®é¢„æµ‹è‚¥èƒ–ç¨‹åº¦ã€‚æˆ‘ä»¬é€šè¿‡æ•°æ®é¢„å¤„ç†ã€æ¨¡å‹é€‰æ‹©ä¸ä¼˜åŒ–ç­‰ä¸€ç³»åˆ—æ­¥éª¤ï¼Œæ„å»ºäº†æœ‰æ•ˆçš„é¢„æµ‹æ¨¡å‹ã€‚ç”¨æˆ·å¯ä»¥è¾“å…¥ç›¸å…³æ•°æ®ï¼Œé€šè¿‡åœ¨ç½‘é¡µä¸­çš„**äº¤äº’**ï¼Œè·å–**ä¸ªæ€§åŒ–**çš„è‚¥èƒ–ç¨‹åº¦é¢„æµ‹ç»“æœï¼Œä»è€Œæ›´å¥½åœ°äº†è§£è‡ªèº«å¥åº·çŠ¶å†µï¼Œé‡‡å–ç›¸åº”çš„é¢„é˜²å’Œå¹²é¢„æªæ–½ã€‚
    """
)







# å…¨å±€å˜é‡ï¼Œç”¨äºå­˜å‚¨æ•°æ®é›†å’Œç›¸å…³æ¨¡å‹ç­‰ä¿¡æ¯
df = None
encoder = None
columns_to_encode = ['Gender', 'family_history_with_overweight', 'FAVC', 'CAEC', 'SMOKE', 'SCC', 'CALC', 'MTRANS', 'NObeyesdad']
X = None
y = None
X_train = None
X_test = None
y_train = None
y_test = None
best_model = None
import base64


# ç”¨æˆ·ä¸Šä¼ æ•°æ®é›†å‡½æ•°
def upload_dataset():
    global df, encoder, X, y, X_train, X_test, y_train, y_test, best_model
    st.subheader("â†’è¯·å…ˆä¸Šä¼ æ•°æ®é›†å“Ÿï¼")
    uploaded_file = st.file_uploader("è¯·ä½¿ç”¨æ‚¨çš„æ•°æ®é›†æ–‡ä»¶ï¼ˆ.CSVæ ¼å¼ï¼‰å¦‚æœæ‚¨æ²¡æœ‰ä¸“é—¨çš„æ•°æ®é›†ï¼Œå¯ä»¥ä¸‹è½½å¹¶ä½¿ç”¨ä¸Šé¢æˆ‘ä»¬ä¸ºæ‚¨å‡†å¤‡çš„æµ‹è¯•ç”¨ä¾‹æ•°æ®é›†ï¼‰", type="csv")

    # æ·»åŠ æ¨¡å‹ä¸Šä¼ åŠŸèƒ½
    uploaded_model_file = st.file_uploader("è¯·ä¸Šä¼ æ¨¡å‹æ–‡ä»¶ï¼ˆ.pklæ ¼å¼ï¼‰å¦‚æœæ‚¨æ²¡æœ‰ä¸“é—¨çš„æ•°æ®é›†ï¼Œå¯ä»¥ä¸‹è½½å¹¶ä½¿ç”¨ä¸‹é¢æˆ‘ä»¬ä¸ºæ‚¨å‡†å¤‡çš„æµ‹è¯•æ¨¡å‹", type="pkl")

    if uploaded_file is not None:
        df = pd.read_csv(uploaded_file)
        # æ•°æ®é¢„å¤„ç†
        encoder = LabelEncoder()
        for column in columns_to_encode:
            df[column] = encoder.fit_transform(df[column])

        # åˆ’åˆ†ç‰¹å¾å’Œç›®æ ‡å˜é‡
        X = df.drop('NObeyesdad', axis=1)
        y = df['NObeyesdad']

        # åˆ’åˆ†è®­ç»ƒé›†å’Œæµ‹è¯•é›†
        X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

        if uploaded_model_file is not None:
            # è·å–è„šæœ¬æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„
            path = str(Path(__file__).parent.absolute())

            # æ„å»ºä¸´æ—¶æ¨¡å‹æ–‡ä»¶å­˜å‚¨è·¯å¾„
            model_temp_path = Path(path) / "temp_model.pkl"

            # å°†ä¸Šä¼ çš„æ¨¡å‹æ–‡ä»¶ä¿å­˜åˆ°ä¸´æ—¶è·¯å¾„
            with open(model_temp_path, 'wb') as f:
                f.write(uploaded_model_file.read())

            # åŠ è½½ç”¨æˆ·ä¸Šä¼ çš„æ¨¡å‹
            best_model = joblib.load(model_temp_path)

            # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
            os.remove(model_temp_path)

            st.sidebar.info(f"âœ… æ•°æ®å·²ä¸Šä¼ ï¼å·²æˆåŠŸåŠ è½½æ‚¨ä¸Šä¼ çš„æ¨¡å‹ï¼è¯·ä½¿ç”¨ä¾§è¾¹æ è¿›è¡Œä¸ªæ€§åŒ–æ•°æ®é…ç½®ã€‚")
        else:
            st.warning("è¯·ä¸Šä¼ æ¨¡å‹æ–‡ä»¶ä»¥ä¾¿è¿›è¡Œåç»­æ“ä½œ(è¯·ä½¿ç”¨æ‚¨è®­ç»ƒçš„æ¨¡å‹ï¼Œæˆ–è€…ä½¿ç”¨æˆ‘ä»¬è®­ç»ƒå¥½çš„XGBoostæ¨¡å‹)ã€‚")

    # è®¾ç½®xgb_model.pklä¸‹è½½æŒ‰é’®åŠç»å¯¹è·¯å¾„
    # è·å–è„šæœ¬æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„
    path = str(Path(__file__).parent.absolute())

    # æ„å»ºxgb_model.pklçš„ç»å¯¹è·¯å¾„
    xgb_model_path = Path(path) / "xgb_model.pkl"

    if os.path.exists(xgb_model_path):
        with open(xgb_model_path, 'rb') as f:
            xgb_model_bytes = f.read()
        st.download_button(
            label="ä¸‹è½½xgb_model.pklï¼ˆæµ‹è¯•æ¨¡å‹ï¼‰",
            data=xgb_model_bytes,
            file_name="xgb_model.pkl",
            mime="application/octet-stream"
        )

def get_user_input_sidebar():
    st.sidebar.subheader("è¯·è¾“å…¥ä»¥ä¸‹ä¸ªäººä¿¡æ¯ï¼š")

    gender = st.sidebar.selectbox("æ€§åˆ«", ["å¥³", "ç”·"], index=1)
    gender_value = 1 if gender == "ç”·" else 0

    age = st.sidebar.number_input("å¹´é¾„", min_value=1, step=1)
    height = st.sidebar.number_input("èº«é«˜ï¼ˆå˜ç±³ï¼‰", min_value=1, step=1)
    weight = st.sidebar.number_input("ä½“é‡ï¼ˆå…¬æ–¤ï¼‰", min_value=1, step=1)

    family_history = st.sidebar.selectbox("å®¶æ—æ˜¯å¦æœ‰è‚¥èƒ–å²", ["å¦", "æ˜¯"], index=0)
    family_history_value = 1 if family_history == "æ˜¯" else 0

    favc = st.sidebar.selectbox("æ˜¯å¦ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©", ["å¦", "æ˜¯"], index=0)
    favc_value = 1 if favc == "æ˜¯" else 0

    fcvc = st.sidebar.selectbox("é¤é£Ÿä¸­é€šå¸¸æ˜¯å¦åƒè”¬èœ", ["å¦", "æ˜¯"], index=1)
    fcvc_value = 1 if fcvc == "æ˜¯" else 0

    ncp = st.sidebar.number_input("æ¯å¤©åƒå¤šå°‘é¡¿æ­£é¤", min_value=1, step=1)

    caec = st.sidebar.selectbox("ä¸¤é¤ä¹‹é—´æ˜¯å¦åƒé£Ÿç‰©", ["å¦", "æ˜¯"], index=0)
    caec_value = 1 if caec == "æ˜¯" else 0

    smoke = st.sidebar.selectbox("æ˜¯å¦å¸çƒŸ", ["å¦", "æ˜¯"], index=0)
    smoke_value = 1 if smoke == "æ˜¯" else 0

    ch2o = st.sidebar.number_input("æ¯å¤©å–å¤šå°‘æ°´ï¼ˆæ¯«å‡ï¼‰", min_value=1, step=1)

    scc = st.sidebar.selectbox("æ˜¯å¦ç›‘æ§æ¯å¤©æ‘„å…¥çš„å¡è·¯é‡Œ", ["å¦", "æ˜¯"], index=0)
    scc_value = 1 if scc == "æ˜¯" else 0

    faf = st.sidebar.selectbox("è¿›è¡Œä½“è‚²æ´»åŠ¨çš„é¢‘ç‡", ["å¾ˆå°‘", "å¶å°”", "ç»å¸¸"], index=1)
    faf_value = {"å¾ˆå°‘": 0, "å¶å°”": 1, "ç»å¸¸": 2}[faf]

    tue = st.sidebar.number_input("æ¯å¤©ä½¿ç”¨ç§‘æŠ€è®¾å¤‡çš„æ—¶é—´ï¼ˆå°æ—¶ï¼‰", min_value=0, step=1)

    calc = st.sidebar.selectbox("å®¶æ—æˆå‘˜æ˜¯å¦æ‚£æœ‰è¶…é‡æˆ–è¶…é‡", ["å¦", "æ˜¯"], index=0)
    calc_value = 1 if calc == "æ˜¯" else 0

    mtrans = st.sidebar.selectbox("äº¤é€šæ–¹å¼", ["æ­¥è¡Œ", "éª‘è‡ªè¡Œè½¦", "å¼€è½¦", "å…¬å…±äº¤é€š"], index=0)
    mtrans_value = {"æ­¥è¡Œ": 0, "éª‘è‡ªè¡Œè½¦": 1, "å¼€è½¦": 2, "å…¬å…±äº¤é€š": 3}[mtrans]

    user_data = {
        'Gender': gender_value,
        'Age': age,
        'Height': height,
        'Weight': weight,
        'family_history_with_overweight': family_history_value,
        'FAVC': favc_value,
        'FCVC': fcvc_value,
        'NCP': ncp,
        'CAEC': caec_value,
        'SMOKE': smoke_value,
        'CH2O': ch2o,
        'SCC': scc_value,
        'FAF': faf_value,
        'TUE': tue,
        'CALC': calc_value,
        'MTRANS': mtrans_value
    }

    if st.sidebar.button("æäº¤ä¿¡æ¯å¹¶è·å–å»ºè®®"):
        return pd.DataFrame(user_data, index=[0])
    else:
        return None

# æ£€æŸ¥æ•°æ®å‡½æ•°
def check_data(user_data):
    global df
    # æ£€æŸ¥åˆ—åæ˜¯å¦ä¸è®­ç»ƒæ•°æ®ä¸€è‡´
    expected_columns = df.columns.tolist()[:-1]  # æ’é™¤ç›®æ ‡å˜é‡åˆ—
    if set(user_data.columns)!= set(expected_columns):
        st.error("è¾“å…¥æ•°æ®çš„åˆ—åä¸è®­ç»ƒæ•°æ®ä¸åŒ¹é…ã€‚")
        return False

    # æ£€æŸ¥åˆ†ç±»å˜é‡çš„å€¼æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…
    for column in ['Gender', 'family_history_with_overweight', 'FAVC', 'CAEC', 'SMOKE', 'SCC', 'CALC', 'MTRANS']:
        if user_data[column].iloc[0] not in [0, 1]:
            st.error(f"{column} çš„å€¼å¿…é¡»ä¸º0æˆ–1ã€‚")
            return False

    # æ£€æŸ¥FCVCçš„å€¼æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…ï¼ˆå‡è®¾ä¸º0æˆ–1ï¼‰
    if user_data['FCVC'].iloc[0] not in [0, 1]:
        st.error("FCVC çš„å€¼å¿…é¡»ä¸º0æˆ–1ã€‚")
        return False

    # æ£€æŸ¥ä½“è‚²æ´»åŠ¨é¢‘ç‡ï¼ˆFAFï¼‰çš„å€¼æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…
    if user_data['FAF'].iloc[0] not in [0, 1, 2]:
        st.error("FAF çš„å€¼å¿…é¡»ä¸º0ã€1æˆ–2ã€‚")
        return False

    # æ£€æŸ¥äº¤é€šæ–¹å¼ï¼ˆMTRANSï¼‰çš„å€¼æ˜¯å¦åœ¨åˆç†èŒƒå›´å†…
    if user_data['MTRANS'].iloc[0] not in [0, 1, 2, 3]:
        st.error("MTRANS çš„å€¼å¿…é¡»ä¸º0ã€1, 2æˆ–3ã€‚")
        return False

    return True

# é¢„æµ‹ç”¨æˆ·è‚¥èƒ–ç¨‹åº¦
def predict_obesity(user_data):
    global encoder
    user_data_encoded = user_data.copy()
    for column in columns_to_encode[:-1]:
        # å…ˆå¯¹encoderè¿›è¡Œæ‹Ÿåˆ
        encoder.fit(df[column])
        user_data_encoded[column] = encoder.transform(user_data_encoded[column])
    prediction = best_model.predict(user_data_encoded)
    return prediction[0]

# ç»™å‡ºå»ºè®®
def give_suggestions(prediction, user_data):
    if prediction == 0:
        st.success("æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œæ‚¨å¯èƒ½ä½“é‡ä¸è¶³ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é’ˆå¯¹æ€§å»ºè®®ï¼š")
        if user_data['Age'].iloc[0] < 18:
            st.write("æ‚¨æ­£å¤„äºç”Ÿé•¿å‘è‚²é˜¶æ®µï¼Œè¦ç¡®ä¿æ‘„å…¥è¶³å¤Ÿçš„è›‹ç™½è´¨ã€é’™ç­‰è¥å…»ç‰©è´¨ï¼Œæ¯”å¦‚å¤šå–ç‰›å¥¶ã€åƒé¸¡è›‹ã€é±¼è‚‰ç­‰ï¼Œä»¥ä¿ƒè¿›èº«ä½“æ­£å¸¸å‘è‚²ã€‚")
        else:
            st.write("å»ºè®®æ‚¨å¢åŠ è¥å…»æ‘„å…¥ï¼Œä¿è¯æ¯æ—¥ä¸‰é¤è§„å¾‹è¿›é£Ÿï¼Œé€‚å½“å¢åŠ å¯Œå«ä¼˜è´¨è›‹ç™½çš„é£Ÿç‰©ï¼Œå¦‚ç˜¦è‚‰ã€è±†ç±»ç­‰ï¼Œä»¥åŠç¢³æ°´åŒ–åˆç‰©çš„æ‘„å–é‡ï¼Œå¯é€‰æ‹©å…¨éº¦é¢åŒ…ã€ç³™ç±³ç­‰å¥åº·çš„ç¢³æ°´æ¥æºã€‚")
    elif prediction == 1:
        st.success("æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œæ‚¨çš„ä½“é‡å¤„äºæ­£å¸¸èŒƒå›´ã€‚ç»§ç»­ä¿æŒå¥åº·çš„é¥®é£Ÿä¹ æƒ¯å’Œé€‚é‡çš„è¿åŠ¨ï¼Œæœ‰åŠ©äºç»´æŒè‰¯å¥½çš„èº«ä½“çŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¿æŒå»ºè®®ï¼š")
        if user_data['FAF'].iloc[0] == 0:
            st.write("æ‚¨ç›®å‰ä½“è‚²æ´»åŠ¨é¢‘ç‡è¾ƒä½ï¼Œå¯é€‚å½“å¢åŠ ä¸€äº›ç®€å•çš„è¿åŠ¨ï¼Œæ¯”å¦‚æ¯å¤©æ•£æ­¥30åˆ†é’Ÿæˆ–è€…æ¯å‘¨è¿›è¡Œä¸¤æ¬¡ç‘œä¼½ç»ƒä¹ ï¼Œä»¥è¿›ä¸€æ­¥æå‡èº«ä½“ç´ è´¨ã€‚")
        elif user_data['FAF'].iloc[0] == 1:
            st.write("æ‚¨çš„è¿åŠ¨é¢‘ç‡å°šå¯ï¼Œç»§ç»­ä¿æŒç›®å‰çš„è¿åŠ¨ä¹ æƒ¯ï¼ŒåŒæ—¶æ³¨æ„é¥®é£Ÿçš„å‡è¡¡æ­é…ï¼Œå¤šåƒè”¬èœæ°´æœï¼Œå°‘åƒæ²¹è…»å’Œé«˜ç³–é£Ÿç‰©ã€‚")
        elif user_data['FAF'].iloc[0] == 2:
            st.write("æ‚¨ç»å¸¸è¿›è¡Œä½“è‚²æ´»åŠ¨ï¼Œéå¸¸æ£’ï¼è®°å¾—è¦åˆç†å®‰æ’ä¼‘æ¯æ—¶é—´ï¼Œä¿è¯å……è¶³çš„ç¡çœ ï¼Œè®©èº«ä½“æœ‰è¶³å¤Ÿçš„æ—¶é—´æ¢å¤ï¼ŒåŒæ—¶ä¹Ÿè¦æ³¨æ„é¥®é£Ÿè¥å…»çš„å…¨é¢æ€§ã€‚")
    elif prediction == 2:
        st.success("æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œæ‚¨å¤„äºè¶…é‡Içº§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰åŠ©äºæ”¹å–„çš„å»ºè®®ï¼š")
        if user_data['FAVC'].iloc[0] == 1:
            st.write("æ‚¨ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ï¼Œè¿™å¯èƒ½æ˜¯å¯¼è‡´è¶…é‡çš„åŸå› ä¹‹ä¸€ã€‚å»ºè®®æ‚¨æ§åˆ¶æ­¤ç±»é£Ÿç‰©çš„æ‘„å…¥ï¼Œæ¯”å¦‚å‡å°‘æ²¹ç‚¸é£Ÿå“ã€ç”œå“çš„é£Ÿç”¨é¢‘ç‡ï¼Œå¯å¤šåƒä¸€äº›è”¬èœæ²™æ‹‰ã€æ°´æœä½œä¸ºæ›¿ä»£ã€‚")
        if user_data['SMOKE'].iloc[0] == 1:
            st.write("å¸çƒŸå¯¹å¥åº·æœ‰è¯¸å¤šä¸åˆ©å½±å“ï¼Œä¹Ÿå¯èƒ½ä¸ä½“é‡è¶…æ ‡æœ‰å…³ã€‚è€ƒè™‘æˆ’çƒŸæˆ–è€…é€æ¸å‡å°‘å¸çƒŸé‡ï¼Œè¿™ä¸ä»…æœ‰åŠ©äºæ§åˆ¶ä½“é‡ï¼Œè¿˜èƒ½æ”¹å–„æ•´ä½“å¥åº·çŠ¶å†µã€‚")
        st.write("å¢åŠ è”¬èœå’Œæ°´æœçš„æ‘„å–ï¼Œæ¯å‘¨è‡³å°‘è¿›è¡Œä¸‰æ¬¡ä¸­ç­‰å¼ºåº¦çš„è¿åŠ¨ï¼Œå¦‚å¿«èµ°ã€æ…¢è·‘ç­‰ï¼Œæ¯æ¬¡è¿åŠ¨æ—¶é—´å»ºè®®åœ¨30åˆ†é’Ÿä»¥ä¸Šã€‚")
    elif prediction == 3:
        st.success("æ ¹æ®æ‚¨æä¾›çš„ ä¿¡æ¯ï¼Œæ‚¨å¤„äºè¶…é‡IIçº§ã€‚éœ€è¦æ›´åŠ ä¸¥æ ¼æ§åˆ¶é¥®é£Ÿï¼Œå‡å°‘ç³–åˆ†å’Œæ²¹è„‚çš„æ‘„å…¥ï¼Œå¢åŠ è¿åŠ¨é‡ï¼Œå¯è€ƒè™‘åŠ å…¥ä¸€äº›åŠ›é‡è®­ç»ƒæ¥æé«˜åŸºç¡€ä»£è°¢ç‡ã€‚ä»¥ä¸‹æ˜¯å…·ä½“å»ºè®®ï¼š")
        if user_data['CH2O'].iloc[0] < 1500:
            st.write("æ‚¨æ¯å¤©çš„é¥®æ°´é‡å¯èƒ½ä¸è¶³ï¼Œå……è¶³çš„æ°´åˆ†æ‘„å…¥æœ‰åŠ©äºæ–°é™ˆä»£è°¢ï¼Œå»ºè®®æ‚¨æ¯å¤©è‡³å°‘å–1500 - 2000æ¯«å‡æ°´ï¼Œä»¥å¸®åŠ©èº«ä½“æ’å‡ºå¤šä½™çš„åºŸç‰©å’Œæ¯’ç´ ã€‚")
        if user_data['SCC'].iloc[0] == 0:
            st.write("æ‚¨ç›®å‰æ²¡æœ‰ç›‘æ§æ¯å¤©æ‘„å…¥çš„å¡è·¯é‡Œï¼Œå»ºè®®æ‚¨å¼€å§‹å…³æ³¨é¥®é£Ÿçš„çƒ­é‡æ‘„å…¥ï¼Œå¯ä½¿ç”¨ä¸€äº›é¥®é£Ÿè®°å½•APPæ¥å¸®åŠ©æ‚¨äº†è§£è‡ªå·±æ¯å¤©åƒäº†å¤šå°‘çƒ­é‡ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ§åˆ¶é¥®é£Ÿã€‚")
        st.write("å¢åŠ è¿åŠ¨é‡ï¼Œé™¤äº†æœ‰æ°§è¿åŠ¨å¤–ï¼Œå¯æ¯å‘¨è¿›è¡Œ2 - 3æ¬¡åŠ›é‡è®­ç»ƒï¼Œå¦‚æ·±è¹²ã€å¹³æ¿æ”¯æ’‘ç­‰ï¼Œæ¯æ¬¡è®­ç»ƒæ—¶é—´å¯æ ¹æ®è‡ªèº«æƒ…å†µå®‰æ’åœ¨20 - 30åˆ†é’Ÿå·¦å³ã€‚")
    elif prediction == 4:
        st.success("æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œæ‚¨å±äºè‚¥èƒ–Iå‹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é’ˆå¯¹æ€§çš„å»ºè®®ï¼š")
        if user_data['CALC'].iloc[0] == 1:
            st.write("æ‚¨å®¶æ—æˆå‘˜æœ‰è¶…é‡æˆ–è‚¥èƒ–æƒ…å†µï¼Œé—ä¼ å› ç´ å¯èƒ½åœ¨æ‚¨çš„ä½“é‡é—®é¢˜ä¸Šèµ·åˆ°ä¸€å®šä½œç”¨ã€‚ä½†é€šè¿‡å¥åº·çš„ç”Ÿæ´»æ–¹å¼è°ƒæ•´ä»ç„¶å¯ä»¥æ”¹å–„ã€‚å»ºè®®æ‚¨å’¨è¯¢ä¸“ä¸šçš„è¥å…»å¸ˆåˆ¶å®šä¸ªæ€§åŒ–çš„é¥®é£Ÿè®¡åˆ’ï¼ŒåŒæ—¶å¢åŠ è¿åŠ¨é‡ï¼Œå¦‚æ¯å¤©è¿›è¡Œè‡³å°‘30åˆ†é’Ÿçš„æœ‰æ°§è¿åŠ¨ï¼Œå¦‚æ¸¸æ³³ã€è·³ç»³ç­‰ã€‚")
        if user_data['MTRANS'].iloc[0] == 2 or user_data['MTRANS'].iloc[0] == 3:
            st.write("æ‚¨çš„äº¤é€šæ–¹å¼å¯èƒ½ç›¸å¯¹æ¯”è¾ƒä¹…åï¼Œæ¯”å¦‚å¼€è½¦æˆ–ä¹˜åå…¬å…±äº¤é€šã€‚å°½é‡å¢åŠ æ­¥è¡Œæˆ–éª‘è‡ªè¡Œè½¦çš„æœºä¼šï¼Œæ¯”å¦‚æå‰ä¸€ä¸¤ç«™ä¸‹è½¦æ­¥è¡Œå»ç›®çš„åœ°ï¼Œæˆ–è€…åœ¨çŸ­è·ç¦»å‡ºè¡Œæ—¶é€‰æ‹©éª‘è‡ªè¡Œè½¦ï¼Œä»¥å¢åŠ æ—¥å¸¸æ´»åŠ¨é‡ã€‚")
        st.write("é¥®é£Ÿæ–¹é¢ï¼Œè¦ä¸¥æ ¼æ§åˆ¶é«˜çƒ­é‡ã€é«˜è„‚è‚ªã€é«˜ç³–é£Ÿç‰©çš„æ‘„å…¥ï¼Œå¢åŠ è”¬èœã€æ°´æœå’Œé«˜çº¤ç»´é£Ÿç‰©çš„æ‘„å–é‡ã€‚")
    elif prediction == 5:
        st.success("æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œæ‚¨å±äºè‚¥èƒ–IIå‹ã€‚å¼ºçƒˆå»ºè®®æ‚¨å°½å¿«å¯»æ±‚åŒ»ç”Ÿæˆ–ä¸“ä¸šå¥åº·é¡¾é—®çš„å¸®åŠ©ï¼Œåˆ¶å®šå…¨é¢çš„å‡è‚¥è®¡åˆ’ï¼ŒåŒ…æ‹¬é¥®é£Ÿè°ƒæ•´ã€è¿åŠ¨æ–¹æ¡ˆä»¥åŠå¯èƒ½çš„åŒ»ç–—å¹²é¢„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›åˆæ­¥å»ºè®®ï¼š")
        if user_data['FCVC'].iloc[0] == 0:
            st.write("æ‚¨é¤é£Ÿä¸­é€šå¸¸ä¸åƒè”¬èœï¼Œè”¬èœå¯¹äºç»´æŒèº«ä½“å¥åº·å’Œæ§åˆ¶ä½“é‡éå¸¸é‡è¦ã€‚è¯·åŠ¡å¿…å¢åŠ è”¬èœçš„æ‘„å…¥é‡ï¼Œæ¯é¤éƒ½åº”ä¿è¯æœ‰ä¸€å®šé‡çš„è”¬èœï¼Œå¯åšæˆè”¬èœæ±¤ã€æ¸…ç‚’è”¬èœç­‰å¤šç§å½¢å¼ã€‚")
        if user_data['NCP'].iloc[0] > 3:
            st.write("æ‚¨æ¯å¤©åƒçš„æ­£é¤é¡¿æ•°è¾ƒå¤šï¼Œå¯èƒ½å¯¼è‡´çƒ­é‡æ‘„å…¥è¿‡å¤šã€‚è€ƒè™‘é€‚å½“å‡å°‘æ­£é¤é¡¿æ•°ï¼Œæˆ–è€…æ§åˆ¶æ¯é¤çš„é£Ÿé‡ï¼ŒåŒæ—¶ä¿è¯é¥®é£Ÿçš„è¥å…»å‡è¡¡ã€‚")
        st.write("è¿åŠ¨æ–¹é¢ï¼Œè¦é€æ­¥å¢åŠ è¿åŠ¨é‡å’Œè¿åŠ¨å¼ºåº¦ï¼Œåœ¨ä¸“ä¸šäººå‘˜çš„æŒ‡å¯¼ä¸‹è¿›è¡Œç³»ç»Ÿçš„è®­ç»ƒï¼ŒåŒ…æ‹¬æœ‰æ°§è¿åŠ¨å’ŒåŠ›é‡è®­ç»ƒç›¸ç»“åˆã€‚")
    elif prediction == 6:
        st.success("æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œæ‚¨å±äºè‚¥èƒ–IIIå‹ã€‚è¿™æ˜¯éå¸¸ä¸¥é‡çš„è‚¥èƒ–æƒ…å†µï¼Œè¯·ç«‹å³å°±åŒ»ï¼Œåœ¨ä¸“ä¸šäººå‘˜çš„æŒ‡å¯¼ä¸‹è¿›è¡Œç³»ç»Ÿçš„æ²»ç–—å’Œç”Ÿæ´»æ–¹å¼çš„æ”¹å˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç´§æ€¥å»ºè®®ï¼š")
        if user_data['family_history_with_overweight'].iloc[0] == 1:
            st.write("æ‚¨å®¶æ—æœ‰è‚¥èƒ–å²ï¼Œé—ä¼ å› ç´ åŠ ä¸Šæ‚¨ç›®å‰çš„ä½“é‡çŠ¶å†µï¼Œæƒ…å†µè¾ƒä¸ºä¸¥å³»ã€‚è¯·ä¸¥æ ¼æŒ‰ç…§åŒ»ç”Ÿçš„å»ºè®®è¿›è¡Œæ²»ç–—å’Œç”Ÿæ´»æ–¹å¼è°ƒæ•´ï¼ŒåŒ…æ‹¬é¥®é£Ÿæ§åˆ¶ã€è¿åŠ¨å®‰æ’ä»¥åŠå¯èƒ½çš„è¯ç‰©æ²»ç–—ç­‰ã€‚")
        if user_data['CAEC'].iloc[0] == 1:
            st.write("æ‚¨ä¸¤é¤ä¹‹é—´è¿˜åƒé£Ÿç‰©ï¼Œè¿™å¯èƒ½è¿›ä¸€æ­¥å¢åŠ äº†çƒ­é‡æ‘„å…¥ã€‚è¯·å°½é‡é¿å…ä¸¤é¤ä¹‹é—´è¿›é£Ÿï¼Œå¦‚éœ€è¿›é£Ÿï¼Œå¯é€‰æ‹©ä½çƒ­é‡ã€é«˜çº¤ç»´çš„é£Ÿç‰©ï¼Œå¦‚æ°´æœã€åšæœï¼ˆå°‘é‡ï¼‰ç­‰ã€‚")
        st.write("è¦å…¨æ–¹ä½åœ°æ”¹å˜ç”Ÿæ´»æ–¹å¼ï¼ŒåŒ…æ‹¬ä¸¥æ ¼çš„é¥®é£Ÿç®¡ç†ã€è§„å¾‹çš„è¿åŠ¨é”»ç‚¼ä»¥åŠå®šæœŸçš„å¥åº·æ£€æŸ¥ç­‰ã€‚")

# æ‰¾å‡ºæ‰€æœ‰ç›¸å…³æŒ‡æ ‡åŠå…¶é‡è¦æ€§ç¨‹åº¦å¹¶è¾“å‡ºå‡½æ•°
def output_all_related_indicators(user_data):
    global best_model, X
    feature_importances = best_model.feature_importances_
    feature_names = X.columns
    importance_dict = dict(zip(feature_names, feature_importances))

    st.subheader("**ä¸‰ã€åŸºäºæ‚¨å¡«å†™çš„ä¿¡æ¯ï¼Œå„ç›¸å…³æŒ‡æ ‡åŠå…¶å¯¹ä½“é‡çŠ¶å†µçš„åˆ†æ**")

    # åˆ†ææ€§åˆ«å¯¹ä½“é‡çš„å¯èƒ½å½±å“
    gender = "ç”·" if user_data['Gender'].iloc[0] == 1 else "å¥³"
    if user_data['Gender'].iloc[0] == 1:
        st.markdown("æ‚¨çš„æ€§åˆ«ä¸º <span style='color: lightblue; font-weight: bold;'>ç”·</span>ğŸ‘¨ï¼Œä¸€èˆ¬æ¥è¯´ç”·æ€§ç›¸å¯¹å¥³æ€§å¯èƒ½æ›´å®¹æ˜“å †ç§¯è‚Œè‚‰ï¼ŒåŸºç¡€ä»£è°¢ç‡å¯èƒ½ç¨é«˜ï¼Œä½†è¿™ä¹Ÿå–å†³äºå…¶ä»–ç”Ÿæ´»ä¹ æƒ¯å› ç´ ï¼Œå¦‚è¿åŠ¨å’Œé¥®é£Ÿç­‰ã€‚ç»“åˆæ‚¨ç›®å‰å¡«å†™çš„å…¶ä»–ä¿¡æ¯æ¥çœ‹ï¼Œæ‚¨çš„ä½“é‡æƒ…å†µå¯èƒ½å—åˆ°å¤šç§å› ç´ ç»¼åˆå½±å“ã€‚", unsafe_allow_html=True)
    else:
        st.markdown("æ‚¨çš„æ€§åˆ«ä¸º <span style='color: lightpink; font-weight: bold;'>å¥³</span>ğŸ‘©ï¼Œå¥³æ€§èº«ä½“æˆåˆ†ç›¸å¯¹ç”·æ€§å¯èƒ½æœ‰æ›´å¤šè„‚è‚ªæ¯”ä¾‹ï¼Œä¸è¿‡é€šè¿‡åˆç†çš„é¥®é£Ÿå’Œè¿åŠ¨ä¹ æƒ¯ä¹Ÿèƒ½å¾ˆå¥½åœ°ç»´æŒå¥åº·ä½“é‡ã€‚å°±æ‚¨ç›®å‰å¡«å†™çš„å„é¡¹ä¿¡æ¯è€Œè¨€ï¼Œæ•´ä½“åœ¨å½±å“ç€æ‚¨çš„ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)

    # åˆ†æå¹´é¾„å¯¹ä½“é‡çš„å¯èƒ½å½±å“
    age = user_data['Age'].iloc[0]
    if age < 18:
        st.markdown("æ‚¨å¤„äº <span style='color: green; font-weight: bold;'>æˆé•¿å‘è‚²æ—¶æœŸ</span>ğŸ§’ï¼Œèº«ä½“è¿˜åœ¨ç”Ÿé•¿å‘è‚²é˜¶æ®µï¼Œè¿™ä¸ªé˜¶æ®µçš„ä½“é‡å˜åŒ–å¯èƒ½æ›´å¤šä¸èº«ä½“å‘è‚²éœ€æ±‚ç›¸å…³ï¼Œåˆç†çš„è¥å…»æ‘„å…¥å¯¹å¥åº·æˆé•¿å°¤ä¸ºé‡è¦ï¼Œç›®å‰æ‚¨çš„ä½“é‡æƒ…å†µä¹Ÿä¼šå—æ­¤é˜¶æ®µç‰¹ç‚¹åŠå…¶ä»–ç”Ÿæ´»ä¹ æƒ¯å…±åŒå½±å“ã€‚", unsafe_allow_html=True)
    elif age < 30:
        st.markdown("æ‚¨å¤„äº <span style='color: orange; font-weight: bold;'>é’å¹´æ—¶æœŸ</span>ğŸ‘±ï¼Œæ–°é™ˆä»£è°¢ç›¸å¯¹è¾ƒå¿«ï¼Œä¸€èˆ¬è¾ƒå®¹æ˜“ç»´æŒä½“é‡ï¼Œä½†å¦‚æœé¥®é£Ÿä¸å‡è¡¡æˆ–ç¼ºä¹è¿åŠ¨ï¼Œä¹Ÿå¯èƒ½å‡ºç°ä½“é‡æ³¢åŠ¨ï¼Œç»“åˆæ‚¨å¡«å†™çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ‚¨çš„é¥®é£Ÿå’Œè¿åŠ¨ä¹ æƒ¯ç­‰éƒ½åœ¨å¯¹å½“å‰ä½“é‡äº§ç”Ÿä½œç”¨ã€‚", unsafe_allow_html=True)
    elif age < 50:
        st.markdown("æ‚¨å¤„äº <span style='color: purple; font-weight: bold;'>ä¸­å¹´æ—¶æœŸ</span>ğŸ‘¨â€ğŸ¦±ï¼Œæ–°é™ˆä»£è°¢å¯èƒ½å¼€å§‹é€æ¸å˜æ…¢ï¼Œéœ€è¦æ›´åŠ å…³æ³¨é¥®é£Ÿå’Œè¿åŠ¨ä»¥ç»´æŒä½“é‡ç¨³å®šï¼Œä»æ‚¨æä¾›çš„ä¿¡æ¯çœ‹ï¼Œåƒæ‚¨çš„é¥®é£Ÿç»“æ„ï¼ˆå¦‚æ˜¯å¦ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ã€é¤é£Ÿä¸­æ˜¯å¦åƒè”¬èœç­‰ï¼‰ä»¥åŠä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰éƒ½ä¸å½“å‰ä½“é‡çŠ¶å†µæ¯æ¯ç›¸å…³ã€‚", unsafe_allow_html=True)
    else:
        st.markdown("æ‚¨å¤„äº <span style='color: gray; font-weight: bold;'>è€å¹´æ—¶æœŸ</span>ğŸ‘´ï¼Œèº«ä½“æœºèƒ½æœ‰æ‰€ä¸‹é™ï¼Œæ–°é™ˆä»£è°¢æ›´æ…¢ï¼Œä½“é‡ç®¡ç†å¯èƒ½éœ€è¦æ›´ç²¾ç»†çš„é¥®é£Ÿæ§åˆ¶å’Œé€‚åº¦çš„è¿åŠ¨ï¼Œæ‚¨å¡«å†™çš„å„é¡¹ç”Ÿæ´»ä¹ æƒ¯ä¿¡æ¯éƒ½åœ¨å½±å“ç€ç›®å‰çš„ä½“é‡æƒ…å†µã€‚", unsafe_allow_html=True)

    # åˆ†æèº«é«˜ä¸ä½“é‡çš„å…³ç³»åŠå½±å“
    height = user_data['Height'].iloc[0]
    weight = user_data['Weight'].iloc[0]
    bmi = weight / ((height / 100) ** 2)
    st.markdown(f"æ ¹æ®æ‚¨å¡«å†™çš„èº«é«˜({height}å˜ç±³)å’Œä½“é‡({weight}å…¬æ–¤)è®¡ç®—å¾—å‡ºçš„BMIå€¼ä¸º <span style='color: red; font-weight: bold;'>{bmi:.2f}</span>ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒBMIåœ¨ä¸åŒèŒƒå›´å¯¹åº”ä¸åŒçš„ä½“é‡çŠ¶å†µç±»åˆ«ï¼Œæ‚¨å¯å‚è€ƒç›¸å…³æ ‡å‡†è¿›ä¸€æ­¥äº†è§£è‡ªå·±çš„ä½“é‡æƒ…å†µã€‚ç»“åˆå…¶ä»–å¡«å†™ä¿¡æ¯ï¼Œå¦‚é¥®é£Ÿã€è¿åŠ¨ç­‰ä¹ æƒ¯ä¹Ÿåœ¨æŒç»­å½±å“ç€è¿™ä¸ªæ•°å€¼ä»¥åŠæ‚¨çš„å®é™…ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)

    # åˆ†æå®¶æ—è‚¥èƒ–å²å¯¹ä½“é‡çš„å¯èƒ½å½±å“
    if user_data['family_history_with_overweight'].iloc[0] == 1:
        st.markdown("æ‚¨å®¶æ—æœ‰è‚¥èƒ–å²ğŸ˜Ÿï¼Œè¿™å¯èƒ½æ„å‘³ç€æ‚¨åœ¨åŸºå› å±‚é¢å­˜åœ¨ä¸€å®šçš„è‚¥èƒ–æ˜“æ„Ÿæ€§ï¼Œä½†å¹¶ä¸æ„å‘³ç€ä¸€å®šä¼šè‚¥èƒ–ï¼Œé€šè¿‡å¥åº·çš„ç”Ÿæ´»æ–¹å¼ï¼Œå¦‚åˆç†é¥®é£Ÿã€è§„å¾‹è¿åŠ¨ç­‰å¯ä»¥æœ‰æ•ˆé™ä½è‚¥èƒ–é£é™©ï¼Œå°±ç›®å‰æ‚¨å¡«å†™çš„å„é¡¹ä¿¡æ¯æ¥çœ‹ï¼Œè¿™äº›ç”Ÿæ´»ä¹ æƒ¯æ­£åœ¨ä¸é—ä¼ å› ç´ å…±åŒä½œç”¨äºæ‚¨çš„ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)
    else:
        st.markdown("æ‚¨å®¶æ—æ²¡æœ‰è‚¥èƒ–å²ğŸ‰ï¼Œè¿™åœ¨ä¸€ç§ç¨‹åº¦ä¸Šæ˜¯ä¸ªä¼˜åŠ¿ï¼Œä½†ä»éœ€ä¿æŒè‰¯å¥½çš„ç”Ÿæ´»ä¹ æƒ¯ä»¥ç»´æŒå¥åº·ä½“é‡ï¼Œä»æ‚¨å¡«å†™çš„ä¿¡æ¯å¯çŸ¥ï¼Œæ‚¨å½“å‰çš„é¥®é£Ÿã€è¿åŠ¨ç­‰ä¹ æƒ¯éƒ½åœ¨å†³å®šç€æ‚¨çš„ä½“é‡æ˜¯å¦èƒ½æŒç»­ä¿æŒåœ¨å¥åº·èŒƒå›´ã€‚", unsafe_allow_html=True)

    # åˆ†æé¥®é£Ÿç›¸å…³æŒ‡æ ‡å¯¹ä½“é‡çš„å¯èƒ½å½±å“
    if user_data['FAVC'].iloc[0] == 1:
        st.markdown("æ‚¨ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ğŸ”ï¼Œè¿™æ˜¯å¯¼è‡´ä½“é‡å¢åŠ çš„ä¸€ä¸ªé‡è¦å› ç´ ï¼Œéœ€è¦æ³¨æ„æ§åˆ¶æ­¤ç±»é£Ÿç‰©çš„æ‘„å…¥ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–é¥®é£Ÿç›¸å…³ä¿¡æ¯ï¼Œå¦‚é¤é£Ÿä¸­æ˜¯å¦åƒè”¬èœã€æ˜¯å¦ç›‘æ§æ¯å¤©æ‘„å…¥çš„å¡è·¯é‡Œç­‰ï¼Œéƒ½åœ¨å½±å“ç€æ‚¨çš„æ•´ä½“é¥®é£Ÿçƒ­é‡æ‘„å…¥æƒ…å†µä»è€Œå½±å“ä½“é‡ã€‚", unsafe_allow_html=True)
    else:
        st.markdown("æ‚¨ä¸ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ğŸ¥—ï¼Œè¿™å¯¹ç»´æŒä½“é‡æ˜¯æœ‰å¸®åŠ©çš„ï¼Œå†é…åˆæ‚¨å¡«å†™çš„å…¶ä»–é¥®é£Ÿæ–¹é¢ä¿¡æ¯ï¼Œæ¯”å¦‚é¤é£Ÿä¸­åƒè”¬èœçš„æƒ…å†µã€æ¯å¤©æ­£é¤é¡¿æ•°ç­‰ï¼Œå…±åŒå¡‘é€ äº†æ‚¨ç›®å‰çš„é¥®é£Ÿçƒ­é‡æ‘„å…¥æ¨¡å¼ï¼Œè¿›è€Œå½±å“ä½“é‡ã€‚", unsafe_allow_html=True)

    if user_data['FCVC'].iloc[0] == 1:
        st.markdown("æ‚¨é¤é£Ÿä¸­é€šå¸¸åƒè”¬èœğŸ¥¦ï¼Œè¿™æ˜¯éå¸¸å¥½çš„é¥®é£Ÿä¹ æƒ¯ï¼Œè”¬èœå¯Œå«è†³é£Ÿçº¤ç»´ç­‰è¥å…»ç‰©è´¨ï¼Œæœ‰åŠ©äºå¢åŠ é¥±è…¹æ„Ÿã€ä¿ƒè¿›è‚ é“è •åŠ¨ï¼Œå¯¹æ§åˆ¶ä½“é‡æœ‰ç§¯æä½œç”¨ï¼Œç»“åˆå…¶ä»–é¥®é£Ÿç›¸å…³ä¿¡æ¯å¦‚æ˜¯å¦ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ç­‰ï¼Œå…±åŒå½±å“ç€æ‚¨çš„ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)
    else:
        st.markdown("æ‚¨é¤é£Ÿä¸­é€šå¸¸ä¸åƒè”¬èœğŸ˜•ï¼Œè”¬èœåœ¨é¥®é£Ÿä¸­å æœ‰é‡è¦åœ°ä½ï¼Œç¼ºä¹è”¬èœæ‘„å…¥å¯èƒ½å¯¼è‡´è¥å…»ä¸å‡è¡¡ã€è†³é£Ÿçº¤ç»´ä¸è¶³ç­‰é—®é¢˜ï¼Œè¿›è€Œå½±å“ä½“é‡æ§åˆ¶ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–é¥®é£Ÿç›¸å…³ä¿¡æ¯å¦‚æ¯å¤©æ­£é¤é¡¿æ•°ç­‰ï¼Œéƒ½åœ¨å¯¹ä½“é‡äº§ç”Ÿå½±å“ã€‚", unsafe_allow_html=True)

    ncp = user_data['NCP'].iloc[0]
    if ncp > 3:
        st.markdown("æ‚¨æ¯å¤©åƒçš„æ­£é¤é¡¿æ•°è¾ƒå¤šğŸ½ï¸ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´çƒ­é‡æ‘„å…¥è¿‡å¤šï¼Œéœ€è¦æ³¨æ„åˆç†æ§åˆ¶æ¯é¤çš„é£Ÿé‡ä»¥åŠé£Ÿç‰©ç§ç±»ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–é¥®é£Ÿç›¸å…³ä¿¡æ¯å¦‚æ˜¯å¦ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ã€æ˜¯å¦ç›‘æ§æ¯å¤©æ‘„å…¥çš„å¡è·¯é‡Œç­‰ï¼Œæ¥ç»¼åˆç®¡ç†é¥®é£Ÿçƒ­é‡æ‘„å…¥ï¼Œä»è€Œå½±å“ä½“é‡ã€‚", unsafe_allow_html=True)
    else:
        st.markdown("æ‚¨æ¯å¤©åƒçš„æ­£é¤é¡¿æ•°ç›¸å¯¹åˆç†ğŸ‘ï¼Œå†é…åˆæ‚¨å¡«å†™çš„å…¶ä»–é¥®é£Ÿç›¸å…³ä¿¡æ¯å¦‚é¤é£Ÿä¸­æ˜¯å¦åƒè”¬èœç­‰ï¼Œæœ‰åŠ©äºç»´æŒå¥åº·çš„é¥®é£Ÿçƒ­é‡æ‘„å…¥æ¨¡å¼ï¼Œè¿›è€Œå½±å“ä½“é‡ã€‚", unsafe_allow_html=True)

    if user_data['CAEC'].iloc[0] == 1:
        st.markdown("æ‚¨ä¸¤é¤ä¹‹é—´è¿˜åƒé£Ÿç‰©ğŸªï¼Œè¿™å¯èƒ½ä¼šå¢åŠ é¢å¤–çš„çƒ­é‡æ‘„å…¥ï¼Œä¸åˆ©äºä½“é‡æ§åˆ¶ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–é¥®é£Ÿç›¸å…³ä¿¡æ¯å¦‚æ˜¯å¦ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ã€æ˜¯å¦ç›‘æ§æ¯å¤©æ‘„å…¥çš„å¡è·¯é‡Œç­‰ï¼Œéœ€è¦æ³¨æ„åˆç†é€‰æ‹©ä¸¤é¤ä¹‹é—´çš„é£Ÿç‰©ï¼Œä»¥é¿å…ä½“é‡å¢åŠ ã€‚", unsafe_allow_html=True)
    else:
        st.markdown("æ‚¨ä¸¤é¤ä¹‹é—´ä¸åƒé£Ÿç‰©ğŸ¥³ï¼Œè¿™æœ‰åŠ©äºå‡å°‘ä¸å¿…è¦çš„çƒ­é‡æ‘„å…¥ï¼Œå¯¹ç»´æŒä½“é‡æœ‰å¸®åŠ©ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–é¥®é£Ÿç›¸å…³ä¿¡æ¯å¦‚é¤é£Ÿä¸­æ˜¯å¦åƒè”¬èœç­‰ï¼Œå…±åŒå¡‘é€ äº†æ‚¨ç›®å‰çš„é¥®é£Ÿçƒ­é‡ç®¡ç†æƒ…å†µï¼Œè¿›è€Œå½±å“ä½“é‡ã€‚", unsafe_allow_html=True)

    if user_data['SCC'].iloc[0] == 1:
        st.markdown("æ‚¨ç›‘æ§æ¯å¤©æ‘„å…¥çš„å¡è·¯é‡ŒğŸ“ˆï¼Œè¿™æ˜¯éå¸¸å¥½çš„ä½“é‡ç®¡ç†ä¹ æƒ¯ï¼Œèƒ½å¤Ÿè®©æ‚¨æ¸…æ¥šäº†è§£è‡ªå·±çš„çƒ­é‡æ‘„å…¥æƒ…å†µï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–é¥®é£Ÿç›¸å…³ä¿¡æ¯å¦‚æ˜¯å¦ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ã€é¤é£Ÿä¸­æ˜¯å¦åƒè”¬èœç­‰ï¼Œæœ‰åŠ©äºæ‚¨æ›´ç²¾å‡†åœ°æ§åˆ¶é¥®é£Ÿï¼Œä»è€Œå½±å“ä½“é‡ã€‚", unsafe_allow_html=True)
    else:
        st.markdown("æ‚¨æ²¡æœ‰ç›‘æ§æ¯å¤©æ‘„å…¥çš„å¡è·¯é‡ŒğŸ˜•ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¯¹è‡ªå·±çš„çƒ­é‡æ‘„å…¥æƒ…å†µä¸å¤ªæ¸…æ¥šï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–é¥®é£Ÿç›¸å…³ä¿¡æ¯å¦‚æ˜¯å¦ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ã€é¤é£Ÿä¸­æ˜¯å¦åƒè”¬èœç­‰ï¼Œå»ºè®®æ‚¨å¯ä»¥è€ƒè™‘å¼€å§‹ç›‘æ§å¡è·¯é‡Œæ‘„å…¥ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†ä½“é‡ã€‚", unsafe_allow_html=True)

    # åˆ†æè¿åŠ¨ç›¸å…³æŒ‡æ ‡å¯¹ä½“é‡çš„å¯èƒ½å½±å“
    if user_data['SMOKE'].iloc[0] == 1:
        st.markdown("æ‚¨å¸çƒŸğŸš¬ï¼Œå¸çƒŸä¸ä»…å¯¹èº«ä½“å¥åº·æœ‰è¯¸å¤šå±å®³ï¼Œè¿˜å¯èƒ½å½±å“æ–°é™ˆä»£è°¢ï¼Œè¿›è€Œå½±å“ä½“é‡ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–ä¿¡æ¯å¦‚ä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ï¼Œå»ºè®®æ‚¨è€ƒè™‘æˆ’çƒŸï¼Œä»¥æ”¹å–„æ•´ä½“å¥åº·çŠ¶å†µå’Œä½“é‡ç®¡ç†ã€‚", unsafe_allow_html=True)
    else:
        st.markdown("æ‚¨ä¸å¸çƒŸğŸ‰ï¼Œè¿™å¯¹èº«ä½“å¥åº·å’Œä½“é‡ç®¡ç†æ˜¯æœ‰å¥½å¤„çš„ï¼Œå†ç»“åˆæ‚¨å¡«å†™çš„ä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ä¿¡æ¯ï¼Œæœ‰åŠ©äºç»´æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼å’Œä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)

    if user_data['FAF'].iloc[0] == 0:
        st.markdown("æ‚¨è¿›è¡Œä½“è‚²æ´»åŠ¨çš„é¢‘ç‡å¾ˆä½ğŸ˜•ï¼Œè¿™ä¸åˆ©äºç»´æŒä½“é‡å’Œèº«ä½“å¥åº·ï¼Œå»ºè®®æ‚¨å¢åŠ ä½“è‚²æ´»åŠ¨çš„é¢‘ç‡å’Œå¼ºåº¦ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–ä¿¡æ¯å¦‚æ¯å¤©ä½¿ç”¨ç§‘æŠ€è®¾å¤‡çš„æ—¶é—´ç­‰ï¼Œåˆç†å®‰æ’æ—¶é—´è¿›è¡Œè¿åŠ¨ï¼Œä»¥æ”¹å–„ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)
    elif user_data['FAF'].iloc[0] == 1:
        st.markdown("æ‚¨è¿›è¡Œä½“è‚²æ´»åŠ¨çš„é¢‘ç‡ä¸ºå¶å°”ğŸ‘ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿˜å¯ä»¥çš„æƒ…å†µï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥æé«˜ä½“è‚²æ´»åŠ¨çš„é¢‘ç‡å’Œå¼ºåº¦ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–ä¿¡æ¯å¦‚æ¯å¤©ä½¿ç”¨ç§‘æŠ€è®¾å¤‡çš„æ—¶é—´ç­‰ï¼Œæ›´å¥½åœ°å¹³è¡¡ç”Ÿæ´»å’Œè¿åŠ¨ï¼Œä»¥ç»´æŒå¥åº·çš„ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)
    elif user_data['FAF'].iloc[0] == 2:
        st.markdown("æ‚¨è¿›è¡Œä½“è‚²æ´»åŠ¨çš„é¢‘ç‡è¾ƒé«˜ğŸ‘ï¼Œè¿™éå¸¸å¥½ï¼Œç»§ç»­ä¿æŒå¹¶åˆç†å®‰æ’è¿åŠ¨å¼ºåº¦å’Œä¼‘æ¯æ—¶é—´ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–ä¿¡æ¯å¦‚æ¯å¤©ä½¿ç”¨ç§‘æŠ€è®¾å¤‡çš„æ—¶é—´ç­‰ï¼Œæœ‰åŠ©äºç»´æŒè‰¯å¥½çš„ä½“é‡çŠ¶å†µå’Œèº«ä½“å¥åº·ã€‚", unsafe_allow_html=True)

    # åˆ†æäº¤é€šæ–¹å¼å¯¹ä½“é‡çš„ä½œç”¨
    if user_data['MTRANS'].iloc[0] == 0:
        st.markdown("æ‚¨é€‰æ‹©æ­¥è¡ŒğŸš¶ä½œä¸ºäº¤é€šæ–¹å¼ï¼Œè¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„å¢åŠ æ—¥å¸¸æ´»åŠ¨é‡çš„æ–¹å¼ï¼Œå¯¹ä½“é‡æ§åˆ¶å’Œèº«ä½“å¥åº·éƒ½æœ‰ç§¯æä½œç”¨ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–ä¿¡æ¯å¦‚ä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ï¼Œæœ‰åŠ©äºç»´æŒå¥åº·çš„ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)
    elif user_data['MTRANS'].iloc[0] == 1:
        st.markdown("æ‚¨é€‰æ‹©éª‘è‡ªè¡Œè½¦ğŸš²ä½œä¸ºäº¤é€šæ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„å¢åŠ æ—¥å¸¸æ´»åŠ¨é‡çš„æ–¹å¼ï¼Œå¯¹ä½“é‡æ§åˆ¶å’Œèº«ä½“å¥åº·æœ‰å¸®åŠ©ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–ä¿¡æ¯å¦‚ä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ï¼Œæœ‰åŠ©äºç»´æŒå¥åº·çš„ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)
    elif user_data['MTRANS'].iloc[0] == 2:
        st.markdown("æ‚¨é€‰æ‹©å¼€è½¦ğŸš—ä½œä¸ºäº¤é€šæ–¹å¼ï¼Œç›¸å¯¹æ¥è¯´å¼€è½¦æ—¶æ´»åŠ¨é‡è¾ƒå°‘ï¼Œéœ€è¦æ³¨æ„åœ¨å…¶ä»–æ–¹é¢å¢åŠ æ´»åŠ¨é‡ï¼Œæ¯”å¦‚å¢åŠ æ­¥è¡Œä¸Šä¸‹è½¦çš„è·ç¦»ã€åœè½¦åå¤šèµ°åŠ¨ç­‰ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–ä¿¡æ¯å¦‚ä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ï¼Œä»¥ç»´æŒå¥åº·çš„ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)
    elif user_data['MTRANS'].iloc[0] == 3:
        st.markdown("æ‚¨é€‰æ‹©å…¬å…±äº¤é€šğŸšŒä½œä¸ºäº¤é€šæ–¹å¼ï¼Œè™½ç„¶åœ¨ä¹˜åè¿‡ç¨‹ä¸­æ´»åŠ¨é‡ä¹Ÿæœ‰é™ï¼Œä½†å¯ä»¥åˆ©ç”¨ä¸Šä¸‹è½¦ç­‰æœºä¼šå¢åŠ æ´»åŠ¨é‡ï¼Œç»“åˆæ‚¨å¡«å†™çš„å…¶ä»–ä¿¡æ¯å¦‚ä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ï¼Œæœ‰åŠ©äºç»´æŒå¥åº·çš„ä½“é‡çŠ¶å†µã€‚", unsafe_allow_html=True)

    # ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºéƒ¨åˆ†é‡è¦ä¿¡æ¯åŠåˆ†æ
    st.markdown("### éƒ¨åˆ†é‡è¦ä¿¡æ¯åŠåˆ†ææ±‡æ€»ï¼š")

    # æå–ç›¸å…³ä¿¡æ¯ç”¨äºè¡¨æ ¼å±•ç¤º
    gender = "ç”·" if user_data['Gender'].iloc[0] == 1 else "å¥³"
    age = user_data['Age'].iloc[0]
    bmi = user_data['Weight'].iloc[0] / ((user_data['Height'].iloc[0] / 100) ** 2)
    family_history = "æœ‰" if user_data['family_history_with_overweight'].iloc[0] == 1 else "æ— "
    high_calorie_food = "æ˜¯" if user_data['FAVC'].iloc[0] == 1 else "å¦"
    vegetable_intake = "æ˜¯" if user_data['FCVC'].iloc[0] == 1 else "å¦"
    meal_count = f"{user_data['NCP'].iloc[0]}é¡¿"
    between_meal_eating = "æ˜¯" if user_data['CAEC'].iloc[0] == 1 else "å¦"
    calorie_monitoring = "æ˜¯" if user_data['SCC'].iloc[0] == 1 else "å¦"
    physical_activity_frequency = f"{user_data['FAF'].iloc[0]}ï¼ˆ0-å¾ˆä½ï¼Œ1-å¶å°”ï¼Œ2-è¾ƒé«˜ï¼‰"
    transportation_mode = "æ­¥è¡Œ" if user_data['MTRANS'].iloc[0] == 0 else "éª‘è‡ªè¡Œè½¦" if user_data['MTRANS'].iloc[0] == 1 else "å¼€è½¦" if user_data['MTRANS'].iloc[0] == 2 else "å…¬å…±äº¤é€š"

    # åˆ†æå„é¡¹å¯¹ä½“é‡çš„å½±å“å¹¶ç”Ÿæˆå¯¹åº”æè¿°
    gender_weight_impact = ""
    if user_data['Gender'].iloc[0] == 1:
        gender_weight_impact = "ç”·æ€§ç›¸å¯¹æ˜“å †ç§¯è‚Œè‚‰ï¼Œå¯èƒ½å› åŸºç¡€ä»£è°¢ç‡ç¨é«˜å½±å“ä½“é‡ï¼Œä½†å—è¿åŠ¨ã€é¥®é£Ÿç­‰å¤šç§å› ç´ ç»¼åˆä½œç”¨ã€‚"
    else:
        gender_weight_impact = "å¥³æ€§èº«ä½“æˆåˆ†ç›¸å¯¹ç”·æ€§å¯èƒ½è„‚è‚ªæ¯”ä¾‹ç¨é«˜ï¼Œé€šè¿‡åˆç†é¥®é£Ÿå’Œè¿åŠ¨å¯ç»´æŒå¥åº·ä½“é‡ï¼Œå—å¤šç§å› ç´ å½±å“ã€‚"

    age_weight_impact = ""
    if age < 18:
        age_weight_impact = "å¤„äºæˆé•¿å‘è‚²æ—¶æœŸï¼Œèº«ä½“ç”Ÿé•¿å‘è‚²éœ€æ±‚å½±å“ä½“é‡ï¼Œéœ€ä¿è¯è¥å…»æ‘„å…¥ï¼Œå—æ­¤é˜¶æ®µç‰¹ç‚¹åŠå…¶ä»–ç”Ÿæ´»ä¹ æƒ¯å…±åŒå½±å“ã€‚"
    elif age < 30:
        age_weight_impact = "å¤„äºé’å¹´æ—¶æœŸï¼Œæ–°é™ˆä»£è°¢å¿«ï¼Œé¥®é£Ÿä¸å‡è¡¡æˆ–ç¼ºä¹è¿åŠ¨å¯èƒ½è‡´ä½“é‡æ³¢åŠ¨ï¼Œå—é¥®é£Ÿã€è¿åŠ¨ä¹ æƒ¯ç­‰å½±å“ã€‚"
    elif age < 50:
        age_weight_impact = "å¤„äºä¸­å¹´æ—¶æœŸï¼Œæ–°é™ˆä»£è°¢é€æ¸å˜æ…¢ï¼Œé¥®é£Ÿç»“æ„å’Œä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ä¸ä½“é‡çŠ¶å†µæ¯æ¯ç›¸å…³ã€‚"
    else:
        age_weight_impact = "å¤„äºè€å¹´æ—¶æœŸï¼Œèº«ä½“æœºèƒ½ä¸‹é™ã€æ–°é™ˆä»£è°¢æ›´æ…¢ï¼Œéœ€ç²¾ç»†é¥®é£Ÿæ§åˆ¶å’Œé€‚åº¦è¿åŠ¨æ¥ç®¡ç†ä½“é‡ï¼Œå—ç”Ÿæ´»ä¹ æƒ¯å½±å“ã€‚"

    bmi_weight_impact = f"BMIå€¼ä¸º{bmi:.2f}ï¼Œä¸åŒèŒƒå›´å¯¹åº”ä¸åŒä½“é‡çŠ¶å†µï¼Œç»“åˆé¥®é£Ÿã€è¿åŠ¨ç­‰ä¹ æƒ¯å½±å“å®é™…ä½“é‡çŠ¶å†µã€‚"

    family_history_weight_impact = ""
    if user_data['family_history_with_overweight'].iloc[0] == 1:
        family_history_weight_impact = "å®¶æ—æœ‰è‚¥èƒ–å²ï¼Œå­˜åœ¨è‚¥èƒ–æ˜“æ„Ÿæ€§ï¼Œé€šè¿‡å¥åº·ç”Ÿæ´»æ–¹å¼å¯é™ä½é£é™©ï¼Œç”Ÿæ´»ä¹ æƒ¯ä¸é—ä¼ å› ç´ å…±åŒä½œç”¨äºä½“é‡ã€‚"
    else:
        family_history_weight_impact = "å®¶æ—æ— è‚¥èƒ–å²ï¼Œæ˜¯ç»´æŒå¥åº·ä½“é‡çš„ä¼˜åŠ¿ï¼Œå½“å‰é¥®é£Ÿã€è¿åŠ¨ç­‰ä¹ æƒ¯å†³å®šä½“é‡æ˜¯å¦ä¿æŒå¥åº·èŒƒå›´ã€‚"

    high_calorie_food_weight_impact = ""
    if user_data['FAVC'].iloc[0] == 1:
        high_calorie_food_weight_impact = "ç»å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ï¼Œæ˜¯å¯¼è‡´ä½“é‡å¢åŠ å› ç´ ï¼Œéœ€æ§åˆ¶æ‘„å…¥ï¼Œç»“åˆå…¶ä»–é¥®é£Ÿä¿¡æ¯å½±å“æ•´ä½“çƒ­é‡æ‘„å…¥åŠä½“é‡ã€‚"
    else:
        high_calorie_food_weight_impact = "ä¸å¸¸åƒé«˜çƒ­é‡é£Ÿç‰©ï¼Œæœ‰åŠ©äºç»´æŒä½“é‡ï¼Œé…åˆå…¶ä»–é¥®é£Ÿæ–¹é¢ä¿¡æ¯å¡‘é€ å½“å‰çƒ­é‡æ‘„å…¥æ¨¡å¼å½±å“ä½“é‡ã€‚"

    vegetable_intake_weight_impact = ""
    if user_data['FCVC'].iloc[0] == 1:
        vegetable_intake_weight_impact = "é¤é£Ÿä¸­å¸¸åƒè”¬èœï¼Œå¯Œå«è†³é£Ÿçº¤ç»´ç­‰è¥å…»ï¼Œæœ‰åŠ©äºå¢åŠ é¥±è…¹æ„Ÿã€ä¿ƒè¿›è‚ é“è •åŠ¨ï¼Œåˆ©äºæ§åˆ¶ä½“é‡ï¼Œç»“åˆå…¶ä»–é¥®é£Ÿä¿¡æ¯å½±å“ä½“é‡çŠ¶å†µã€‚"
    else:
        vegetable_intake_weight_impact = "é¤é£Ÿä¸­é€šå¸¸ä¸åƒè”¬èœï¼Œå¯èƒ½å¯¼è‡´è¥å…»ä¸å‡è¡¡ã€è†³é£Ÿçº¤ç»´ä¸è¶³ï¼Œå½±å“ä½“é‡æ§åˆ¶ï¼Œç»“åˆå…¶ä»–é¥®é£Ÿä¿¡æ¯å¯¹ä½“é‡æœ‰å½±å“ã€‚"

    meal_count_weight_impact = ""
    if user_data['NCP'].iloc[0] > 3:
        meal_count_weight_impact = "æ¯å¤©æ­£é¤é¡¿æ•°è¾ƒå¤šï¼Œå¯èƒ½å¯¼è‡´çƒ­é‡æ‘„å…¥è¿‡å¤šï¼Œéœ€åˆç†æ§åˆ¶é£Ÿé‡åŠé£Ÿç‰©ç§ç±»ï¼Œç»“åˆå…¶ä»–é¥®é£Ÿä¿¡æ¯ç®¡ç†çƒ­é‡æ‘„å…¥å½±å“ä½“é‡ã€‚"
    else:
        meal_count_weight_impact = "æ¯å¤©æ­£é¤é¡¿æ•°ç›¸å¯¹åˆç†ï¼Œé…åˆå…¶ä»–é¥®é£Ÿä¿¡æ¯æœ‰åŠ©äºç»´æŒå¥åº·çš„çƒ­é‡æ‘„å…¥æ¨¡å¼ï¼Œè¿›è€Œå½±å“ä½“é‡ã€‚"

    between_meal_eating_weight_impact = ""
    if user_data['CAEC'].iloc[0] == 1:
        between_meal_eating_weight_impact = "ä¸¤é¤ä¹‹é—´è¿˜åƒé£Ÿç‰©ï¼Œå¯èƒ½å¢åŠ é¢å¤–çƒ­é‡æ‘„å…¥ï¼Œä¸åˆ©äºä½“é‡æ§åˆ¶ï¼Œéœ€åˆç†é€‰æ‹©é£Ÿç‰©ï¼Œç»“åˆå…¶ä»–é¥®é£Ÿä¿¡æ¯é¿å…ä½“é‡å¢åŠ ã€‚"
    else:
        between_meal_eating_weight_impact = "ä¸¤é¤ä¹‹é—´ä¸åƒé£Ÿç‰©ï¼Œæœ‰åŠ©äºå‡å°‘ä¸å¿…è¦çƒ­é‡æ‘„å…¥ï¼Œå¯¹ç»´æŒä½“é‡æœ‰å¸®åŠ©ï¼Œç»“åˆå…¶ä»–é¥®é£Ÿä¿¡æ¯å¡‘é€ çƒ­é‡ç®¡ç†æƒ…å†µå½±å“ä½“é‡ã€‚"

    calorie_monitoring_weight_impact = ""
    if user_data['SCC'].iloc[0] == 1:
        calorie_monitoring_weight_impact = "ç›‘æ§æ¯å¤©æ‘„å…¥çš„å¡è·¯é‡Œï¼Œèƒ½æ¸…æ¥šäº†è§£çƒ­é‡æ‘„å…¥æƒ…å†µï¼Œæœ‰åŠ©äºæ›´ç²¾å‡†åœ°æ§åˆ¶é¥®é£Ÿï¼Œç»“åˆå…¶ä»–é¥®é£Ÿä¿¡æ¯å½±å“ä½“é‡ã€‚"
    else:
        calorie_monitoring_weight_impact = "æœªç›‘æ§æ¯å¤©æ‘„å…¥çš„å¡è·¯é‡Œï¼Œå¯èƒ½å¯¹çƒ­é‡æ‘„å…¥æƒ…å†µä¸æ¸…æ¥šï¼Œå»ºè®®è€ƒè™‘ç›‘æ§ä»¥æ›´å¥½åœ°ç®¡ç†ä½“é‡ï¼Œç»“åˆå…¶ä»–é¥®é£Ÿä¿¡æ¯ã€‚"

    physical_activity_frequency_weight_impact = ""
    if user_data['FAF'].iloc[0] == 0:
        physical_activity_frequency_weight_impact = "ä½“è‚²æ´»åŠ¨é¢‘ç‡å¾ˆä½ï¼Œä¸åˆ©äºç»´æŒä½“é‡å’Œèº«ä½“å¥åº·ï¼Œå»ºè®®å¢åŠ é¢‘ç‡å’Œå¼ºåº¦ï¼Œç»“åˆå…¶ä»–ä¿¡æ¯åˆç†å®‰æ’è¿åŠ¨æ”¹å–„ä½“é‡çŠ¶å†µã€‚"
    elif user_data['FAF'].iloc[0] == 1:
        physical_activity_frequency_weight_impact = "ä½“è‚²æ´»åŠ¨é¢‘ç‡ä¸ºå¶å°”ï¼Œå¯è¿›ä¸€æ­¥æé«˜é¢‘ç‡å’Œå¼ºåº¦ï¼Œç»“åˆå…¶ä»–ä¿¡æ¯æ›´å¥½åœ°å¹³è¡¡ç”Ÿæ´»å’Œè¿åŠ¨ä»¥ç»´æŒå¥åº·ä½“é‡çŠ¶å†µã€‚"
    elif user_data['FAF'].iloc[0] == 2:
        physical_activity_frequency_weight_impact = "ä½“è‚²æ´»åŠ¨é¢‘ç‡è¾ƒé«˜ï¼Œéå¸¸å¥½ï¼Œç»§ç»­ä¿æŒå¹¶åˆç†å®‰æ’è¿åŠ¨å¼ºåº¦å’Œä¼‘æ¯æ—¶é—´ï¼Œç»“åˆå…¶ä»–ä¿¡æ¯ç»´æŒè‰¯å¥½ä½“é‡çŠ¶å†µå’Œèº«ä½“å¥åº·ã€‚"

    transportation_mode_weight_impact = ""
    if user_data['MTRANS'].iloc[0] == 0:
        transportation_mode_weight_impact = "é€‰æ‹©æ­¥è¡Œä½œä¸ºäº¤é€šæ–¹å¼ï¼Œæ˜¯å¢åŠ æ—¥å¸¸æ´»åŠ¨é‡çš„å¥½æ–¹å¼ï¼Œå¯¹ä½“é‡æ§åˆ¶å’Œèº«ä½“å¥åº·æœ‰ç§¯æä½œç”¨ï¼Œç»“åˆä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ä¿¡æ¯ç»´æŒå¥åº·ä½“é‡çŠ¶å†µã€‚"
    elif user_data['MTRANS'].iloc[0] == 1:
        transportation_mode_weight_impact = "é€‰æ‹©éª‘è‡ªè¡Œè½¦ä½œä¸ºäº¤é€šæ–¹å¼ï¼Œä¹Ÿæ˜¯å¢åŠ æ—¥å¸¸æ´»åŠ¨é‡çš„ä¸é”™æ–¹å¼ï¼Œå¯¹ä½“é‡æ§åˆ¶å’Œèº«ä½“å¥åº·æœ‰å¸®åŠ©ï¼Œç»“åˆä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ä¿¡æ¯ç»´æŒå¥åº·ä½“é‡çŠ¶å†µã€‚"
    elif user_data['MTRANS'].iloc[0] == 2:
        transportation_mode_weight_impact = "é€‰æ‹©å¼€è½¦ä½œä¸ºäº¤é€šæ–¹å¼ï¼Œå¼€è½¦æ—¶æ´»åŠ¨é‡è¾ƒå°‘ï¼Œéœ€åœ¨å…¶ä»–æ–¹é¢å¢åŠ æ´»åŠ¨é‡ï¼Œç»“åˆä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ä¿¡æ¯ç»´æŒå¥åº·ä½“é‡çŠ¶å†µã€‚"
    else:
        transportation_mode_weight_impact = "é€‰æ‹©å…¬å…±äº¤é€šä½œä¸ºäº¤é€šæ–¹å¼ï¼Œè™½ä¹˜åè¿‡ç¨‹ä¸­æ´»åŠ¨é‡æœ‰é™ï¼Œä½†å¯åˆ©ç”¨ä¸Šä¸‹è½¦ç­‰æœºä¼šå¢åŠ æ´»åŠ¨é‡ï¼Œç»“åˆä½“è‚²æ´»åŠ¨é¢‘ç‡ç­‰ä¿¡æ¯ç»´æŒå¥åº·ä½“é‡çŠ¶å†µã€‚"

    table_data = {
        "æŒ‡æ ‡": ["æ€§åˆ«", "å¹´é¾„", "BMI", "å®¶æ—è‚¥èƒ–å²", "é«˜çƒ­é‡é£Ÿç‰©æ‘„å…¥", "é¤é£Ÿè”¬èœæ‘„å…¥", "æ­£é¤é¡¿æ•°", "ä¸¤é¤é—´è¿›é£Ÿ", "ç›‘æ§å¡è·¯é‡Œ", "ä½“è‚²æ´»åŠ¨é¢‘ç‡", "äº¤é€šæ–¹å¼"],
        "æƒ…å†µ": [gender, f"{age}å²", f"{bmi:.2f}", family_history, high_calorie_food, vegetable_intake, meal_count, between_meal_eating, calorie_monitoring, physical_activity_frequency, transportation_mode],
        "å¯¹ä½“é‡å½±å“åˆ†æ": [gender_weight_impact, age_weight_impact, bmi_weight_impact, family_history_weight_impact, high_calorie_food_weight_impact, vegetable_intake_weight_impact, meal_count_weight_impact, between_meal_eating_weight_impact, calorie_monitoring_weight_impact, physical_activity_frequency_weight_impact, transportation_mode_weight_impact]
    }
    styled_table = pd.DataFrame(table_data)
    styled_table = styled_table.style.set_table_styles([
        {'selector': 'th', 'props': [('background-color', '#f2f2f2'), ('text-align', 'center'), ('font-size', '18px')]},
        {'selector': 'td', 'props': [('text-align', 'center'), ('font-size', '16px')]}
    ])
    # è®¾ç½®è¡¨æ ¼é«˜åº¦å’Œå®½åº¦ï¼Œä½¿å…¶æ˜¾ç¤ºæ›´å¤§
    styled_table = styled_table.set_properties(**{'height': '500px', 'width': '100%'})

    # ç›´æ¥ä½¿ç”¨st.dataframeå±•ç¤ºå¸¦æœ‰æ ·å¼çš„è¡¨æ ¼
    st.dataframe(styled_table)
    # ç»™å‡ºå¥åº·è®¡åˆ’ç›¸å…³ç½‘å€é“¾æ¥
    st.markdown("å¦‚éœ€åˆ¶å®šæ›´è¯¦ç»†çš„å¥åº·è®¡åˆ’ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹ç½‘å€ï¼š[ä¸­å›½è¥å…»å­¦ä¼šå®˜ç½‘](https://www.cnsoc.org/)")

# æ–°å¢å‡½æ•°ï¼šå±•ç¤ºå¹¶æä¾›æµ‹è¯•ç”¨ä¾‹æ•°æ®é›†ä¸‹è½½
def show_and_download_test_dataset():
    st.subheader("**æµ‹è¯•ç”¨ä¾‹æ•°æ®é›†**")
    # è·å–è„šæœ¬æ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„
    path = str(Path(__file__).parent.absolute())

    # æ„å»ºæµ‹è¯•æ•°æ®æ–‡ä»¶çš„ç»å¯¹è·¯å¾„
    test_file_path = Path(path) / "fixed_encoded_dataset.csv"

    # è¯»å–æµ‹è¯•æ•°æ®
    test_df = pd.read_csv(test_file_path)

    # å±•ç¤ºæµ‹è¯•æ•°æ®é›†
    st.dataframe(test_df)

    # æä¾›ä¸‹è½½æŒ‰é’®
    csv = test_df.to_csv(index=False).encode('utf-8')
    st.download_button(
        label="ä¸‹è½½æµ‹è¯•ç”¨ä¾‹æ•°æ®é›†",
        data=csv,
        file_name="test_encoded_dataset.csv",
        mime="text/csv"
    )

# åœ¨mainå‡½æ•°ä¸­è°ƒç”¨è¯¥å‡½æ•°ï¼Œåœ¨ä¸Šä¼ æ•°æ®é›†ä¹‹å‰å±•ç¤ºæµ‹è¯•ç”¨ä¾‹æ•°æ®é›†
def main():
    st.markdown("<h1 style='text-align: center;'>PART2 åŸºäºXGBoostå’Œç‰¹å¾å­¦ä¹ çš„ä¸ªæ€§åŒ–è‚¥èƒ–ç¨‹åº¦åˆ†æğŸ¥¦</h1>", unsafe_allow_html=True)
    show_and_download_test_dataset()

    upload_dataset()

    user_data = get_user_input_sidebar()
    if user_data is not None:
        if check_data(user_data):
            prediction = predict_obesity(user_data)
            give_suggestions(prediction, user_data)
            output_all_related_indicators(user_data)
        else:
            st.error("æ•°æ®æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ•°æ®ã€‚")

if __name__ == "__main__":
    main()

